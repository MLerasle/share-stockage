%section#main-content
	.row
		.small-12.large-12.columns
			- unless notice.nil?
				.alert-box.info.radius{ "data-alert" => "" }
					= notice
					%a{ href: "#", class: "close" } &times;
			- unless alert.nil?
				.alert-box.alert.radius{ "data-alert" => "" }
					= alert
					%a{ href: "#", class: "close" } &times;
	.row
		.small-12.large-12.columns
			%h2 Mes annonces
			%hr
		
			- if @user.adverts.any?
				%table#adverts_table
					%thead
						%tr{ style: "border-bottom: 1px solid black" }
							%th.hide-for-medium-down
							%th Informations
							%th{ style: "text-align:center;" } Réservations
							%th{ style: "text-align:center;" } En attente
							%th{ style: "text-align:center;" } Statut
							%th{ style: "text-align:center;" } Activer/Désactiver
							%th
					%tbody
						- @user.adverts.each do |advert|
							%tr
								%td.image_cell.hide-for-medium-down
									- if advert.pictures.any?
										= image_tag advert.pictures.first.image(:medium)
									- else
										= image_tag "camera.png"
								%td
									%h5
										%i.fa.fa-map-marker
										= advert.full_address
									%ul
										%li
											Type d'espace:
											%strong= advert.type_name
										%li
											Peut accueillir
											%strong
												= advert.volume
												m³
										%li
											= advert.access_type_hr
								%td{ style: "text-align:center;" }= advert.reservations.count
								%td{ style: "text-align:center;" }= advert.reservations_waiting_validation.count
								%td{ style: "text-align:center;" }
									- if advert.validated
										%span{ style: "color: green" } Validée
									- else
										%span{ style: "color: red" } En attente de validation
								%td{ style: "text-align:center;" }= link_to advert.activate_title, activate_advert_path(advert), method: :put
								%td= link_to "Voir les réservations", edit_advert_path(advert)

			- else
				%h4.subheader Vous n'avez aucune annonce.
				= link_to "Publier une annonce maintenant", new_advert_path, class: "button radius"
	
	%br						
	.row
		.small-12.large-12.columns
			%h2 Mes réservations
			%hr 
		
			- if @user.reservations.pending.any?
				%table{ style: "width: 100%" }
					%thead
						%tr
							%th Titre annonce
							%th Début
							%th Fin
							%th
					%tbody
						- @user.reservations.pending.each do |r|
							%tr
								%td= link_to r.advert.title, advert_path(r.advert)
								%td= r.start_date
								%td= r.end_date
								%td= link_to "Modifier les dates", edit_advert_reservation_path(r.advert, r), data: {'reveal-id' => 'editReservationModal'}
						
								#editReservationModal.reveal-modal{"data-reveal" => ""}
									= render partial: 'reservations/edit', locals: { advert: r.advert, reservation: r }
									%a.close-reveal-modal ×
			- else
				%h4.subheader Vous n'avez aucune demande de réservation en attente.
				
- content_for :scripts do
	:javascript
		var nowTemp = new Date();
		var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
		var checkin = $('#reservation_start_date').fdatepicker({
			format: 'yyyy-mm-dd',
			onRender: function (date) {
				return date.valueOf() < now.valueOf() ? 'disabled' : '';
			}
		}).on('changeDate', function (ev) {
			if (ev.date.valueOf() > checkout.date.valueOf()) {
				var newDate = new Date(ev.date)
				newDate.setDate(newDate.getDate() + 1);
				checkout.update(newDate);
				}
				checkin.hide();
				$('#reservation_end_date')[0].focus();
		}).data('datepicker');
		var checkout = $('#reservation_end_date').fdatepicker({
			format: 'yyyy-mm-dd',
			onRender: function (date) {
				return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
			}
		}).on('changeDate', function (ev) {
			checkout.hide();
		}).data('datepicker');